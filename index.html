<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä»»å‹™æŒ‘æˆ°ç³»çµ± (åœ°ç„ç–ŠåŠ ç‰ˆ)</title>
    <style>
        :root { --main-blue: #007bff; --success-green: #28a745; --fail-red: #dc3545; --warn-orange: #fd7e14; --dark-grey: #343a40; --hell-purple: #4a0072; }
        body { font-family: "Microsoft JhengHei", sans-serif; background-color: #f8f9fa; padding: 20px; max-width: 600px; margin: auto; }
        .card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        h2 { margin-top: 0; color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        
        .status-container { display: flex; justify-content: space-around; text-align: center; }
        .status-box { flex: 1; }
        .status-num { font-size: 24px; font-weight: bold; display: block; }
        
        .item { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; border-bottom: 1px solid #f1f1f1; }
        .item:last-child { border-bottom: none; }
        .task-text { flex-grow: 1; font-size: 16px; }
        
        /* åœ°ç„ä»»å‹™ç‰¹æ®Šæ¨£å¼ */
        .item-hell { background-color: #f3e5f5; border: 2px solid var(--hell-purple); border-radius: 8px; padding: 10px; margin-bottom: 5px; }
        .item-hell .task-text { color: var(--hell-purple); font-weight: bold; }

        button { border: none; border-radius: 6px; padding: 8px 12px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        .btn-draw { background: var(--main-blue); color: white; width: 100%; padding: 15px; font-size: 18px; }
        .btn-shop { background: var(--warn-orange); color: white; width: 100%; padding: 10px; font-size: 16px; margin-top: 10px; }
        .btn-ok { background: var(--success-green); color: white; margin-right: 5px; }
        .btn-no { background: var(--fail-red); color: white; }
        .btn-del { background: #666; color: white; padding: 4px 8px; font-size: 12px; }
        .btn-hell { background: var(--hell-purple); color: white; }
        .btn-reset { background: var(--dark-grey); color: white; width: 100%; padding: 10px; margin-top: 30px; opacity: 0.8; }
        .btn-reset:hover { opacity: 1; background: black; }
        button:disabled { background: #ccc !important; cursor: not-allowed; }

        #punishSection { background: #fff3f3; border: 2px dashed var(--fail-red); padding: 15px; border-radius: 8px; margin-bottom: 20px; display: none; }
        .punish-header { color: var(--fail-red); font-weight: bold; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }

        .input-area { display: flex; gap: 5px; margin-top: 10px; flex-wrap: wrap;}
        .input-row { display: flex; gap: 5px; width: 100%; }
        input, select { flex-grow: 1; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        .input-small { flex-grow: 0 !important; width: 80px; } 
    </style>
</head>
<body>

    <div class="card">
        <h1 style="text-align: center; margin: 0 0 20px 0;">ğŸ® æˆé•·ç³»çµ± (åœ°ç„ç–ŠåŠ ç‰ˆ)</h1>
        <div class="status-container">
            <div class="status-box">
                <span class="status-num" style="color: var(--success-green);" id="scoreDisplay">0</span>
                ç´¯ç©ç©åˆ†
            </div>
            <div class="status-box">
                <span class="status-num" style="color: var(--fail-red);" id="failDisplay">0 / 3</span>
                å¤±æ•—ç´¯ç©
            </div>
            <div class="status-box">
                <span class="status-num" style="color: var(--hell-purple);" id="hellProbDisplay">0%</span>
                åœ°ç„æ©Ÿç‡
            </div>
        </div>
        
        <button class="btn-shop" onclick="reduceDifficulty()">ğŸ›¡ï¸ æ¶ˆè€— 300 ç©åˆ†ï¼šé™ä½æœ€é«˜æ‡²ç½°å€ç‡ 1%</button>
        
        <button class="btn-draw" style="margin-top:10px;" onclick="drawTasks()">ğŸ² æŠ½å–ä»Šæ—¥ä»»å‹™</button>
        
        <div id="statusMessage" style="text-align: center; font-size: 12px; color: #6f42c1; margin-top: 5px; font-weight: bold; min-height: 18px;"></div>
    </div>

    <div id="punishSection">
        <div class="punish-header">
            <span>ğŸš¨ æœªå®Œæˆçš„æ‡²ç½°</span>
            <span id="punishCount" style="font-size: 14px;">(0)</span>
        </div>
        <div id="activePunishList"></div>
    </div>

    <div class="card">
        <h2>ğŸ¯ ä»Šæ—¥ä»»å‹™</h2>
        <div id="todayList">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹...</div>
    </div>

    <div class="card">
        <h2>ğŸ“š ä¸€èˆ¬ä»»å‹™åº«</h2>
        <div class="input-area">
            <input type="text" id="taskInput" placeholder="è¼¸å…¥ä»»å‹™æŒ‡ä»¤...">
            <button class="btn-ok" onclick="addToPool('normal')">æ–°å¢</button>
        </div>
        <div id="normalPool" style="margin-top: 10px; max-height: 150px; overflow-y: auto;"></div>
    </div>

    <div class="card" style="border: 1px solid var(--hell-purple);">
        <h2 style="color: var(--hell-purple); border-color: var(--hell-purple);">ğŸ‘¿ åœ°ç„ä»»å‹™åº« (é«˜é¢¨éšª)</h2>
        <p style="font-size: 12px; color: #666; margin: 0 0 10px 0;">çå‹µï¼š50ç©åˆ† | å¤±æ•—ï¼š+30 å¤±æ•—æ•¸ (å³ 10 å€‹æ‡²ç½°)</p>
        <div class="input-area">
            <input type="text" id="hellInput" placeholder="è¼¸å…¥åœ°ç„ä»»å‹™ (ä¾‹: è·‘ 3000 å…¬å°º)">
            <button class="btn-hell" onclick="addToPool('hell')">æ–°å¢</button>
        </div>
        <div id="hellPool" style="margin-top: 10px; max-height: 150px; overflow-y: auto;"></div>
    </div>

    <div class="card">
        <h2>ğŸ’€ æ‡²ç½°ä»»å‹™åº«</h2>
        <div class="input-area">
            <div class="input-row">
                <select id="punishType" onchange="togglePunishInputs()" style="flex-grow:0; width: 100px;">
                    <option value="other">å…¶ä»–</option>
                    <option value="count">è¨ˆæ¬¡</option>
                    <option value="time">è¨ˆæ™‚</option>
                </select>
                <input type="text" id="punishName" placeholder="ä»»å‹™åç¨± (ä¾‹: æ·±è¹²)">
            </div>
            <div class="input-row" id="punishValueRow" style="display:none;">
                <input type="number" id="punishBase" class="input-small" placeholder="æ•¸å€¼">
                <input type="text" id="punishUnit" class="input-small" placeholder="å–®ä½">
                <button class="btn-no" onclick="addToPool('punish')">æ–°å¢</button>
            </div>
            <div class="input-row" id="punishBtnRow">
                <button class="btn-no" style="width: 100%;" onclick="addToPool('punish')">æ–°å¢</button>
            </div>
        </div>
        <div id="punishPool" style="margin-top: 10px; max-height: 200px; overflow-y: auto;"></div>
    </div>

    <div style="text-align: center; margin-bottom: 30px;">
        <button class="btn-reset" onclick="resetSystem()">âš ï¸ é‡ç½®æ‰€æœ‰è³‡æ–™ (éœ€ç¢ºèª)</button>
    </div>

    <script>
        // --- 1. è³‡æ–™çµæ§‹ ---
        
        const defaultTasks = ["å–æ°´ 500cc", "æ·±è¹² 10 ä¸‹", "çœ‹æ›¸ 10 åˆ†é˜"];
        const defaultHellTasks = ["å…¨é€Ÿè·‘ 1 å…¬é‡Œ", "æ–·é£Ÿ 16 å°æ™‚", "èƒŒèª¦ä¸€é¦–è‹±æ–‡è©©"];
        const defaultPunishments = [
            { type: 'count', name: 'åŸåœ°è·³', base: 50, unit: 'ä¸‹', addedPercent: 0 },
            { type: 'time', name: 'å¹³æ¿æ”¯æ’', base: 30, unit: 'ç§’', addedPercent: 0 },
            { type: 'other', name: 'å¤§å–Šæˆ‘æ˜¯ç¬¨è›‹', base: 0, unit: '', addedPercent: 0 }
        ];

        let data = {
            score: parseInt(localStorage.getItem('task_score')) || 0,
            failCount: parseInt(localStorage.getItem('task_fail')) || 0,
            normalPool: JSON.parse(localStorage.getItem('task_pool_normal')) || defaultTasks,
            punishPool: JSON.parse(localStorage.getItem('task_pool_punish')) || defaultPunishments,
            hellPool: JSON.parse(localStorage.getItem('task_pool_hell')) || defaultHellTasks,
            hellProbability: parseFloat(localStorage.getItem('task_hell_prob')) || 0,
            todayTasks: JSON.parse(localStorage.getItem('task_today')) || [],
            activePunishments: JSON.parse(localStorage.getItem('task_active_punishments')) || [],
            forceNumericNext: JSON.parse(localStorage.getItem('task_force_numeric')) || false
        };

        // è³‡æ–™ç›¸å®¹æ€§ä¿®æ­£
        data.punishPool.forEach(p => {
            if (p.level !== undefined) { p.addedPercent = p.level * 5; delete p.level; }
            if (p.addedPercent === undefined) p.addedPercent = 0;
        });

        // --- 2. æ ¸å¿ƒé‚è¼¯ ---

        function drawTasks() {
            // é˜²åˆ·æ©Ÿåˆ¶ï¼šæª¢æŸ¥æ˜¯å¦æ‰€æœ‰ä»»å‹™éƒ½å·²è™•ç† (done æˆ– fail)
            const hasPending = data.todayTasks.some(t => t.status === 'pending');
            if (hasPending) {
                return alert("â›” ç¦æ­¢é‡åˆ·ï¼\nä½ é‚„æœ‰æœªå®Œæˆçš„ä»»å‹™ï¼Œå¿…é ˆå…¨éƒ¨è¨­ç‚ºã€å®Œæˆã€‘æˆ–ã€å¤±æ•—ã€‘å¾Œæ‰èƒ½æŠ½å–æ–°ä»»å‹™ã€‚");
            }

            if (data.normalPool.length < 3) return alert("ä¸€èˆ¬ä»»å‹™åº«è‡³å°‘éœ€è¦ 3 å€‹ä»»å‹™ï¼");
            
            // å †ç–Šæ‡²ç½°è­¦å‘Š
            if (data.activePunishments.length >= 2) {
                let msg = "âš ï¸ ç´¯ç©å¤ªå¤šæ‡²ç½°ï¼";
                data.activePunishments.forEach(activeP => {
                    const poolItem = data.punishPool.find(p => p.name === activeP.name);
                    if (poolItem) {
                        poolItem.addedPercent += 1;
                        msg += `\n[${poolItem.name}] é›£åº¦æå‡è‡³ ${100 + poolItem.addedPercent}%`;
                    }
                });
                alert(msg);
            }

            // --- 1. å…ˆæŠ½å–ä¸€èˆ¬çš„æ™®é€šä»»å‹™ ---
            const shuffled = [...data.normalPool].sort(() => 0.5 - Math.random());
            let newTasks = shuffled.slice(0, 3).map(cmd => ({ 
                cmd, 
                status: 'pending', 
                type: 'normal' 
            }));

            // --- 2. åˆ¤å®šæ˜¯å¦è§¸ç™¼åœ°ç„ä»»å‹™ (ç–ŠåŠ æ¨¡å¼) ---
            const rand = Math.random() * 100; // 0 ~ 99.99
            if (data.hellPool.length > 0 && rand < data.hellProbability) {
                
                const hellIdx = Math.floor(Math.random() * data.hellPool.length);
                const hellTaskCmd = data.hellPool[hellIdx];
                
                // å»ºç«‹åœ°ç„ä»»å‹™ç‰©ä»¶
                const hellTask = { 
                    cmd: hellTaskCmd, 
                    status: 'pending', 
                    type: 'hell'
                };
                
                // æ’å…¥åˆ°ä»»å‹™åˆ—è¡¨çš„æœ€å‰æ–¹ (unshift)
                newTasks.unshift(hellTask);
                
                alert(`ğŸ‘¿ å„é‹é™è‡¨ï¼\né™¤äº†ä»Šæ—¥ä»»å‹™å¤–ï¼Œä½ é‚„é¡å¤–æŠ½åˆ°äº†åœ°ç„ä»»å‹™ï¼š\nã€${hellTaskCmd}ã€‘\n\n(åœ°ç„æ©Ÿç‡é‡ç½®ç‚º 0%)`);
                data.hellProbability = 0; // é‡ç½®æ©Ÿç‡
            }
            
            // æ›´æ–°ä»Šæ—¥ä»»å‹™åˆ—è¡¨
            data.todayTasks = newTasks;
            saveAndRender();
        }

        function updateTaskStatus(index, status) {
            if (data.todayTasks[index].status !== 'pending') return;
            const task = data.todayTasks[index];
            task.status = status;

            if (status === 'done') {
                data.score += (task.type === 'hell' ? 50 : 10);
            } else {
                // --- å¤±æ•—è™•ç†é‚è¼¯ ---
                if (task.type === 'hell') {
                    data.failCount += 30; // åœ°ç„å¤±æ•— +30
                    alert("ğŸ’€ åœ°ç„ä»»å‹™å¤±æ•—ï¼\nå¤±æ•—è¨ˆæ•¸ +30 (å°‡è§¸ç™¼ 10 å€‹æ‡²ç½°)");
                } else {
                    data.failCount++;
                    // ä¸€èˆ¬ä»»å‹™å¤±æ•—ï¼Œå¢åŠ åœ°ç„æ©Ÿç‡
                    data.hellProbability += 1; 
                }

                // æª¢æŸ¥æ˜¯å¦è§¸ç™¼æ‡²ç½°
                let triggeredCount = 0;
                while (data.failCount >= 3) {
                    triggerPunish(true); // éœé»˜æ¨¡å¼
                    data.failCount -= 3;
                    triggeredCount++;
                }

                if (triggeredCount > 0) {
                    alert(`âŒ å·²è§¸ç™¼ ${triggeredCount} å€‹æ‡²ç½°ä»»å‹™ï¼\nè«‹æŸ¥çœ‹ä¸Šæ–¹æœªå®Œæˆæ‡²ç½°åˆ—è¡¨ã€‚`);
                }
            }
            saveAndRender();
        }

        function triggerPunish(silent = false) {
            if (data.punishPool.length === 0) return alert("ç„¡æ‡²ç½°åº«å­˜ï¼");

            let candidatePool = [];
            if (data.forceNumericNext) {
                candidatePool = data.punishPool.filter(p => p.type !== 'other');
                if (candidatePool.length === 0) candidatePool = data.punishPool;
            } else {
                candidatePool = data.punishPool;
            }

            const idx = Math.floor(Math.random() * candidatePool.length);
            const task = candidatePool[idx]; 

            let finalValue = 0;
            let displayStr = "";
            let alertMsg = "";

            if (task.type === 'other') {
                displayStr = task.name;
                const numericTasks = data.punishPool.filter(p => p.type !== 'other');
                if (numericTasks.length > 0) {
                    const minPercent = Math.min(...numericTasks.map(t => t.addedPercent));
                    const targets = numericTasks.filter(t => t.addedPercent === minPercent);
                    const buffTarget = targets[Math.floor(Math.random() * targets.length)];
                    buffTarget.addedPercent += 5;
                    if (!silent) alertMsg = `\nğŸ’€ è§¸ç™¼è©›å’’ï¼š[${buffTarget.name}] å€ç‡ +5%ï¼`;
                }
                data.forceNumericNext = true;
            } else {
                let multiplier = 1 + (task.addedPercent / 100);
                finalValue = Math.round(task.base * multiplier);
                displayStr = `${task.name} ${finalValue} ${task.unit}`;
                
                task.addedPercent += 5;
                if (!silent) alertMsg = `\n(æ­¤ä»»å‹™ä¸‹æ¬¡åŸºç¤å€ç‡è®Šç‚º ${100 + task.addedPercent}%)`;

                if (data.forceNumericNext) {
                    data.forceNumericNext = false;
                }
            }

            data.activePunishments.push({
                name: task.name,
                display: displayStr,
                timestamp: new Date().getTime()
            });

            if (!silent) {
                alert(`âŒ å¤±æ•—ä¸‰æ¬¡ï¼è¿½åŠ æ‡²ç½°ï¼š${displayStr}${alertMsg}`);
            }
        }

        function completePunish(index) {
            data.activePunishments.splice(index, 1);
            saveAndRender();
        }

        function reduceDifficulty() {
            if (data.score < 300) return alert("ç©åˆ†ä¸è¶³ï¼éœ€è¦ 300 ç©åˆ†ã€‚");
            const validPool = data.punishPool.filter(p => p.type !== 'other');
            if (validPool.length === 0) return alert("æ²’æœ‰å¯é™ä½é›£åº¦çš„æ•¸å€¼å‹æ‡²ç½°ï¼");

            const maxPercent = Math.max(...validPool.map(p => p.addedPercent));
            const candidates = validPool.filter(p => p.addedPercent === maxPercent);
            const target = candidates[Math.floor(Math.random() * candidates.length)];

            if (100 + target.addedPercent <= 10) return alert("è©²ä»»å‹™å€ç‡å·²é”ä¸‹é™ (10%)ï¼Œç„¡æ³•å†é™ä½ï¼");

            data.score -= 300;
            target.addedPercent -= 1;

            alert(`ğŸ›¡ï¸ æˆåŠŸï¼ä»»å‹™ [${target.name}] çš„å€ç‡é™ä½äº† 1%ã€‚\nç•¶å‰å€ç‡ï¼š${100 + target.addedPercent}%`);
            saveAndRender();
        }

        function resetSystem() {
            if (confirm("âš ï¸ è­¦å‘Šï¼šç¢ºå®šè¦é‡ç½®æ‰€æœ‰è³‡æ–™å—ï¼Ÿ\næ‰€æœ‰çš„ç©åˆ†ã€ä»»å‹™åº«ã€æ‡²ç½°å€ç‡éƒ½æœƒæ¶ˆå¤±ï¼")) {
                if (confirm("âš ï¸ å†æ¬¡ç¢ºèªï¼šé€™é …æ“ä½œç„¡æ³•å¾©åŸã€‚\n\nçœŸçš„è¦åˆªé™¤ä¸¦é‡æ–°é–‹å§‹å—ï¼Ÿ")) {
                    localStorage.clear();
                    location.reload();
                }
            }
        }

        function addToPool(poolType) {
            if (poolType === 'normal') {
                const input = document.getElementById('taskInput');
                if (!input.value.trim()) return;
                data.normalPool.push(input.value.trim());
                input.value = "";
            } else if (poolType === 'hell') {
                const input = document.getElementById('hellInput');
                if (!input.value.trim()) return;
                data.hellPool.push(input.value.trim());
                input.value = "";
            } else {
                const pType = document.getElementById('punishType').value;
                const pName = document.getElementById('punishName').value.trim();
                const pBase = parseFloat(document.getElementById('punishBase').value);
                let pUnit = document.getElementById('punishUnit').value.trim();

                if (!pName) return alert("è«‹è¼¸å…¥ä»»å‹™åç¨±");
                if (pType !== 'other') {
                    if (isNaN(pBase) || pBase <= 0) return alert("è«‹è¼¸å…¥æœ‰æ•ˆçš„åŸºç¤æ•¸å€¼");
                    if (pType === 'time') pUnit = "ç§’";
                    if (!pUnit) return alert("è«‹è¼¸å…¥å–®ä½");
                }

                data.punishPool.push({
                    type: pType,
                    name: pName,
                    base: pType === 'other' ? 0 : pBase,
                    unit: pUnit,
                    addedPercent: 0
                });
                document.getElementById('punishName').value = "";
                document.getElementById('punishBase').value = "";
                if(pType !== 'time') document.getElementById('punishUnit').value = "";
            }
            saveAndRender();
        }

        function deleteFromPool(type, index) {
            if (type === 'normal') data.normalPool.splice(index, 1);
            else if (type === 'hell') data.hellPool.splice(index, 1);
            else data.punishPool.splice(index, 1);
            saveAndRender();
        }

        function togglePunishInputs() {
            const type = document.getElementById('punishType').value;
            const valRow = document.getElementById('punishValueRow');
            const btnRow = document.getElementById('punishBtnRow');
            const unitInput = document.getElementById('punishUnit');

            if (type === 'other') {
                valRow.style.display = 'none';
                btnRow.style.display = 'flex';
            } else {
                valRow.style.display = 'flex';
                btnRow.style.display = 'none';
                if (type === 'time') {
                    unitInput.value = "ç§’";
                    unitInput.disabled = true;
                    unitInput.style.backgroundColor = "#eee";
                } else {
                    unitInput.value = "";
                    unitInput.disabled = false;
                    unitInput.style.backgroundColor = "white";
                    unitInput.placeholder = "å–®ä½";
                }
            }
        }

        // --- 4. æ¸²æŸ“èˆ‡å„²å­˜ ---

        function saveAndRender() {
            localStorage.setItem('task_score', data.score);
            localStorage.setItem('task_fail', data.failCount);
            localStorage.setItem('task_pool_normal', JSON.stringify(data.normalPool));
            localStorage.setItem('task_pool_hell', JSON.stringify(data.hellPool));
            localStorage.setItem('task_pool_punish', JSON.stringify(data.punishPool));
            localStorage.setItem('task_today', JSON.stringify(data.todayTasks));
            localStorage.setItem('task_active_punishments', JSON.stringify(data.activePunishments));
            localStorage.setItem('task_force_numeric', JSON.stringify(data.forceNumericNext));
            localStorage.setItem('task_hell_prob', data.hellProbability);

            document.getElementById('scoreDisplay').innerText = data.score;
            document.getElementById('failDisplay').innerText = data.failCount + " / 3";
            document.getElementById('hellProbDisplay').innerText = data.hellProbability + "%";

            const statusMsg = document.getElementById('statusMessage');
            if (data.forceNumericNext) {
                statusMsg.innerHTML = "âš¡ è©›å’’ç”Ÿæ•ˆä¸­ï¼šä¸‹æ¬¡æ‡²ç½°é™å®šç‚ºã€è¨ˆæ™‚ã€‘æˆ–ã€è¨ˆæ¬¡ã€‘ä»»å‹™";
            } else {
                statusMsg.innerHTML = "";
            }

            const punishSection = document.getElementById('punishSection');
            const punishListDiv = document.getElementById('activePunishList');
            document.getElementById('punishCount').innerText = `(${data.activePunishments.length})`;

            if (data.activePunishments.length > 0) {
                punishSection.style.display = 'block';
                punishListDiv.innerHTML = data.activePunishments.map((p, i) => `
                    <div class="item" style="border-color: #ffcccc;">
                        <span style="font-weight:bold; color: #a00;">${p.display}</span>
                        <button class="btn-ok" onclick="completePunish(${i})">å®Œæˆ</button>
                    </div>
                `).join('');
            } else {
                punishSection.style.display = 'none';
            }

            const todayDiv = document.getElementById('todayList');
            if (data.todayTasks.length === 0) {
                todayDiv.innerHTML = "å°šæœªæŠ½å–ä»»å‹™";
            } else {
                todayDiv.innerHTML = data.todayTasks.map((t, i) => {
                    const isHell = t.type === 'hell';
                    const itemClass = isHell ? 'item item-hell' : 'item';
                    const icon = isHell ? 'ğŸ‘¿' : '';
                    
                    return `
                    <div class="${itemClass}">
                        <span class="task-text" style="${t.status !== 'pending' ? 'text-decoration: line-through; color: #999;' : ''}">
                            ${icon} ${t.cmd}
                        </span>
                        ${t.status === 'pending' ? `
                            <button class="btn-ok" onclick="updateTaskStatus(${i}, 'done')">å®Œæˆ</button>
                            <button class="btn-no" onclick="updateTaskStatus(${i}, 'fail')">å¤±æ•—</button>
                        ` : `<span>${t.status === 'done' ? 'âœ…' : 'âŒ'}</span>`}
                    </div>
                `}).join('');
            }

            renderPoolList('normalPool', 'normal');
            renderPoolList('hellPool', 'hell');
            renderPunishList();
        }

        function renderPoolList(elementId, type) {
            const list = type === 'normal' ? data.normalPool : data.hellPool;
            document.getElementById(elementId).innerHTML = list.map((cmd, i) => `
                <div class="item">
                    <span style="font-size: 14px;">${cmd}</span>
                    <button class="btn-del" onclick="deleteFromPool('${type}', ${i})">åˆªé™¤</button>
                </div>
            `).join('');
        }

        function renderPunishList() {
            const list = data.punishPool;
            document.getElementById('punishPool').innerHTML = list.map((item, i) => {
                let desc = "";
                if (item.type === 'other') {
                    desc = `<b>${item.name}</b> <span style="color:#666; font-size:12px;">(ç‰¹æ®Š)</span>`;
                } else {
                    const currentRate = 100 + item.addedPercent;
                    desc = `<b>${item.name}</b> <span style="color:#666; font-size:12px;">(å€ç‡:${currentRate}% | åŸºç¤:${item.base}${item.unit})</span>`;
                }

                return `
                <div class="item">
                    <span style="font-size: 14px;">${desc}</span>
                    <button class="btn-del" onclick="deleteFromPool('punish', ${i})">åˆªé™¤</button>
                </div>
            `}).join('');
        }

        togglePunishInputs();
        saveAndRender();

    </script>
</body>
</html>
